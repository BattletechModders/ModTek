# Modern Mod Development with C#

While BattleTech is old, HBS did made a major upgrade from .NET Framework 3.5 to .NET Framework 4.7.2 before the final patches.
This allows us to use modern development tools and libraries which are explained below.

### SDK style csproj files

Many older mods still use the old style csproj files. Don't copy those,use SDK style csproj formats! ModTek itself uses them.
- Recommended by Microsoft: When you create projects with old .NET Framework it uses the new SDK style csproj format.
- Removes the need to list all files in the csproj file, in SDK style csproj files there are wildcards to include files.
  This avoids loosing files in your projects while they are still in your repository. Also allows to collaborate better to due less merge conflicts.
- Removes a lot of boilerplate!
  - Create empty project in old format: 50 lines in csproj + AssemblyInfo.cs + one line more for every source code file
  - Create empty project in new format: 16 lines in csproj + NO AssemblyInfo.cs since autogenerated + NO additional line for every source code due to wildcard.

### Rider or Visual Studio with Resharper

Those are part of the JetBrains family of products like IntellJ, WebStorm, if you know those you can already guess what you get.
- Code inspections are very good, it notifies so on bad code practices, issues with your code or just some inconsistent styling.
- You learn C# quickly because they provide refactoring suggestions as you write code.
- Manual code refactoring is also great.
- Git integration with preview and commit + stashing is very good. The three way merges also one of the best integrated solutions, though you probably won't need merging alot.

### C# Latest:

While .NET Framework 4.7.2 came with C# 7.3, you can use the latest C# (as of this writing 11) with albeit less features. Here are the highlights:
- Nullable reference types: When enabled, all reference types (e.g. string) are assumed to be wanted to be not-null.
  Assigning null or not initializing a field variable will lead to compiler warnings. Modern languages (Kotlin/Swift) have this already, C# has it too.
  Only caveat is that while we can use this, they are some language improvements regarding this feature that are not available in our old .NET Framework version.
- Target-typed object creation: Write `new()` instead of `new Type()` this reduces clutter and thus readability of your code. This becomes apparent when writing lots of structures.
- Pattern matching: No not the Regex variant, but for writing code. With C# 7.3 lof it null checks can be mode more compact and implicit. Allowing for more readable code.
  `filter.ComponentTypes != null && filter.ComponentTypesLength > 0` -> `filter.ComponentTypes is { Length: > 0 }`
- File scoped namespaces: Removes unnecessary whitespaces everywhere.
- Null coalescing assignments: `myvar = myvar ?? default()` -> `myvar ??= default()`. Resharper/Rider suggest these automatically.
- Raw string literals: Basically multiline strings that support quotes in the content without having to escape them.

For more see the left navigation on [Microsoft C# Features](https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/proposals/csharp-11.0/raw-string-literal).

### Use Publicizer not Traverse

Thanks to the work at BepInEx, we now have an easy way to publicize an assembly, why do we need that?
- Makes all classes, methods, properties and fields of assemblies public (with some exceptions).
- Avoids the need to write reflection tools or wrappers to access private stuff, leads to cleaner and faster code at runtime.

Add to your csproj:
```xml
<ItemGroup>
  <PackageReference Include="BepInEx.AssemblyPublicizer.MSBuild" Version="0.3.0" />
</ItemGroup>
```

and modify a reference to an assembly to include `Publicize="true"`:
```xml
<Reference Include="Assembly-CSharp" Publicize="true">
  <Private>False</Private>
</Reference>
```

So instead of writing something with Harmony Traverse:
```csharp
new Traverse(__instance).Property("InternetAvailable").SetValue(success);
```

One now writes it this way:
```csharp
__instance.InternetAvailable = success;
```

Much cleaner right?

### Use HBS logging

Vanilla HBS logging was not that great, but with ModTek we have additional capabilities that far surpass what one can quickly do.

See [ModTek Logging](LOGGING.md) for an all logging features ModTek provides.

Any mod not using HBS logging will make debugging harder as you can't at a glance see issues between mods, e.g. one mod creating an exception for another.

### Use github

Use git versioning to help keep track of changes to your mod.
Publish the sources of your mod on github, so its accessible in case you loose interest but someone want to take over.
You can even setup github workflow to automatically build and release your mod on github.

Use ubuntu and dotnet to build stuff, as windows is slower.

### For help use Discord

RogueTech and other communities have lots of help coming in.
